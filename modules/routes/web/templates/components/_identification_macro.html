{# --------------------------------------------------------------------
  id_line(roll)  –  v5 + alignment classes
-------------------------------------------------------------------- #}
{% macro id_line(roll) %}

    {# ------------ helper: pick “positive/negative” class ------------- #}
    {% macro sign_class(v, suf='') %}
        {{ 'negative' ~ suf if v|float < 0 else 'positive' ~ suf }}
    {% endmacro %}

    {# ------------ 1 · parse & clamp the roll-percentage -------------- #}
    {% set pct_raw = roll.actualRollPercentage | default('') %}
    {% if pct_raw and pct_raw != 'NaN' %}
        {% set pct_val = pct_raw.rstrip('%') | float %}
        {% if pct_val < 0   %}{% set pct_val =   0 %}{% endif %}
        {% if pct_val > 100 %}{% set pct_val = 100 %}{% endif %}
        {% set pct_txt = '%.2f' % pct_val %}
    {% else %}
        {% set pct_val, pct_txt = none, none %}
    {% endif %}

    {# ------------ 2 · colour for the [xx.xx %] bracket ---------------- #}
    {% if pct_val is not none %}
        {% if pct_val == 0 %}
            {% set color_hex = '#A80000' %}
        {% elif pct_val == 100 %}
            {% set color_hex = '#54fcfc' %}
        {% else %}
            {# blend  #F85252 → #56FE56 over 0.1–99.9 % #}
            {% set ratio = pct_val / 99.9 %}
            {% set r = (248 + ratio * ( 86 - 248)) | int %}
            {% set g = ( 82 + ratio * (254 -  82)) | int %}
            {% set b = ( 82 + ratio * ( 86 -  82)) | int %}
            {% set color_hex = '#' ~ '%02X%02X%02X' % (r, g, b) %}
        {% endif %}
        {% set pct_style = 'color:' ~ color_hex %}
    {% else %}
        {% set pct_style = '' %}
    {% endif %}

    {# ------------ 3 · variable ? fixed ? ------------------------------ #}
    {% set variable = pct_val is not none and not roll.statRange.fixed %}

    {# ------------ 4 · render  ---------------------------------------- #}
    {% if variable %}
        {#  one rolled value + %  ------------------------------------- #}
        <div class="stat-row">
            <span class="stat-value {{ sign_class(roll.statRoll) }}">
                {{- roll.statRoll -}}{% if roll.unit == 'PERCENT' %}%{% endif %}
            </span>

            <span class="stat-name">{{ roll.displayName }}</span>

            <span class="stat-pct" style="{{ pct_style }}">
                [{{ pct_txt }}%]
            </span>
        </div>

    {% elif roll.statRange.fixed %}
        {#  fixed stat  (no roll %)  ---------------------------------- #}
        <div class="stat-row">
            <span class="stat-value {{ sign_class(roll.statRoll) }}">
                {%- if roll.unit == 'PERCENT' -%}
                    {{- roll.statRoll -}}%
                {%- elif roll.unit == 'TIER' -%}
                    {{- roll.statRoll -}} tier
                {%- else -%}
                    {{- roll.statRoll -}}
                {%- endif -%}
            </span>

            <span class="stat-name">{{ roll.displayName }}</span>

            <span class="stat-pct"></span>  {# empty placeholder #}
        </div>

    {% else %}
        {#  range stat  (low to high)  -------------------------------- #}
        <div class="stat-row">
            {# ───── range stat (low to high) ───── #}
            <span class="stat-value {{ sign_class(roll.statRange.low) }}">
                {{- roll.statRange.low -}}{% if roll.unit == 'PERCENT' %}%{% endif %} to
                {{- roll.statRange.high -}}{% if roll.unit == 'PERCENT' %}%{% endif %}
            </span>

            <span class="stat-name">{{ roll.displayName }}</span>

            <span class="stat-pct"></span>
        </div>
    {% endif %}

{% endmacro %}
