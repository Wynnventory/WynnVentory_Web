{# --------------------------------------------------------------------
  id_line(roll) – v6  (uses roll.rollPercentageColor from back-end)
-------------------------------------------------------------------- #}
{% macro id_line(roll) %}

    {# ------------ helper: class based on sign ----------------------- #}
    {% macro sign_class(v, suf='') %}
        {{ 'negative' ~ suf if v|float < 0 else 'positive' ~ suf }}
    {% endmacro %}

    {# ------------ 1 · parse & sanitise rollPercentage ---------------- #}
    {% set pct_raw = roll.rollPercentage | default('') %}
    {% if pct_raw and pct_raw != 'NaN' %}
        {% set pct_val = pct_raw.rstrip('%') | float %}
        {% set pct_txt = '%.1f' % pct_val %}
    {% else %}
        {% set pct_val, pct_txt = none, none %}
    {% endif %}

    {# ------------ 2 · colour: take it directly from JSON ------------- #}
    {% if roll.rollPercentageColor %}
        {% set pct_style = 'color:' ~ roll.rollPercentageColor %}
    {% else %}
        {% set pct_style = '' %}
    {% endif %}

    {# ------------ 3 · variable? fixed? ------------------------------- #}
    {% set variable = pct_val is not none and not roll.statRange.fixed %}

    {# ------------ 4 · render ---------------------------------------- #}
    {% if variable %}
        <div class="stat-row">
            <span class="stat-value {{ sign_class(roll.statRoll) }}">
                {{- roll.statRoll -}}{% if roll.unit == 'PERCENT' %}%{% endif %}
            </span>
            <span class="stat-name">{{ roll.displayName }}</span>
            <span class="stat-pct" style="{{ pct_style }}">[{{ pct_txt }}%]</span>
        </div>

    {% elif roll.statRange.fixed %}
        <div class="stat-row">
            <span class="stat-value {{ sign_class(roll.statRoll) }}">
                {%- if roll.unit == 'PERCENT' -%}
                    {{- roll.statRoll -}}%
                {%- elif roll.unit == 'TIER' -%}
                    {{- roll.statRoll -}} tier
                {%- else -%}
                    {{- roll.statRoll -}}
                {%- endif -%}
            </span>
            <span class="stat-name">{{ roll.displayName }}</span>
            <span class="stat-pct"></span>
        </div>

    {% else %}
        <div class="stat-row">
            <span class="stat-value {{ sign_class(roll.statRange.low) }}">
                {{- roll.statRange.low -}}{% if roll.unit == 'PERCENT' %}%{% endif %}
                 to
                {{- roll.statRange.high -}}{% if roll.unit == 'PERCENT' %}%{% endif %}
            </span>
            <span class="stat-name">{{ roll.displayName }}</span>
            <span class="stat-pct"></span>
        </div>
    {% endif %}

{% endmacro %}
